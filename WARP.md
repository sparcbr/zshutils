# WARP.md

This file was generated by AI, and I don't have time atm to review it. It's just a collection of libs in zsh that I used.

This file provides guidance to WARP (warp.dev) when working with code in this repository.


## Repository Overview

zshutils is a collection of ZSH shell utilities and functions for power users. It provides a comprehensive framework of shell functions, aliases, and utilities organized into modular library files.

## Architecture

### Core Structure

**Main Entry Points:**
- `zshenv` - Environment setup, sourced first, sets up paths and global variables
- `zshrc` - Interactive shell configuration, loads plugin manager (zinit) and libraries

**Library System (`zsh_libs/`):**
The repository uses a modular library system where functionality is organized by domain:
- `zsh_main` - Core framework (exceptions, error handling, `techo`, `throw`, `abort`, `implode`, `explode`)
- `zsh_functions` - Interactive utilities (`chooser`, `input`, `confirm`, `readkey`, color system)
- `zsh_git` - Git workflows (`gpull`, `gpush`, `glog`, `gstatus`, `gdiff`, `commit`, etc.)
- `zsh_sql` - MySQL/database operations (`sql` function with extensive options)
- `zsh_aliases` - Command aliases and wrapper functions
- `zsh_file` - File operations
- `zsh_network` - Network utilities
- `zsh_device` - Device management
- `zsh_proc` - Process management
- `zsh_android` - Android development tools
- `zsh_progtools` - Programming utilities
- `zsh_conversion` - Data conversion functions
- `zsh_debug` - Debugging utilities
- `zsh_progress_bar` - Progress indicators

Libraries are loaded via the `include` function (defined in `zsh_main`), which supports lazy loading and dependency management.

**Function Organization:**
- `zfunctions/` - Autoloadable functions directory
- Lazy-loaded functions are declared in library headers with `#lazyload=func1,func2,...` comments

### Key Utilities

**chooser (`zsh-select`):**
Interactive menu selection tool using ZSH's terminal capabilities. Used extensively throughout the codebase for user prompts. See README.md for usage examples with options like `-n`, `-D`, `-H`, `-F`, `--multi`, `--file`.

**Exception System:**
- Hierarchy: `Ex` → `IoEx`/`SqlEx` → specific exceptions like `FileIoEx`, `ConstraintSqlEx`
- Use `throw` to raise exceptions, `catch` in `always` blocks
- `abort` for fatal errors with optional exception types (`--ex ExType`)

**Color System:**
- Global associative array `C` contains ANSI color codes
- `techo` for colored output: `techo -c <color> "message"`
- `colorSet` to define custom colors

**Third-party Tools:**
- `peco` - Interactive filtering (included binary)
- `fzf-tmux` - Fuzzy finder with tmux integration
- Various standalone utilities in root directory

## Development Commands

### Testing Functions
There are no formal test suites. To test functions:
```bash
# Source the library containing the function
source zsh_libs/zsh_<library>

# Call the function directly
<function_name> [args]
```

### Working with Libraries
```bash
# Reload a library
include -r <library_name>

# Load with debugging
DEBUG=2 include -r <library_name>

# Edit a library
vim zsh_libs/zsh_<library>
```

### Profiling ZSH Startup
```bash
# Create debug trigger
touch $TMPDIR/debug_zshrc

# Start new shell (will be profiled)
zsh

# Or use the zshrc function
zshrc p
```

### Git Workflow (Custom Commands)
```bash
# Colorized log with author highlighting
glog [-n <count>] [-r] [--all]

# Smart pull (handles conflicts, suggests stashing)
gpull

# Interactive diff
gdiff --interactive

# Show staged files
gstaged  # or gds

# Unstage files
gunstage <file>  # or guns
```

### SQL Operations
```bash
# Interactive SQL
sql -d <dbname> -i

# Execute query with output to variable
sql -o row 'SELECT * FROM table'

# Remote execution via SSH
sql --ssh <host> -d <dbname> 'SELECT ...'

# Table operations
tablelist      # List tables in current database
tableshow <table>  # Show table structure
```

## Code Patterns

### Function Definition
```zsh
function myfunction()
{
    local var1 var2
    integer count
    zparseopts -D -M -A _opts - v:=var1 n:=count
    
    # Function body
}
```

### Error Handling
```zsh
{
    # try block
    some_operation || abort 1 "Operation failed"
} always {
    if catch '*'; then
        # cleanup
        techo -c warn "Caught: $CAUGHT"
    fi
}
```

### Using chooser
```zsh
# Simple selection
chooser -v selected_option "Option 1" "Option 2" "Option 3"

# With keyboard shortcuts
chooser -v opt --use-keys -f1 'E' 'Edit' 'V' 'View' 'Q' 'Quit'

# Multi-select
chooser --multi -v selected_items "${items[@]}"
```

### Loading Dependencies
```zsh
# At top of library file
include -r functions  # Force reload
include -q aliases    # Quiet mode
include -l sql        # From zsh_libs/zsh_sql
```

## Configuration Files

- `.gitignore` - Excludes tags, logs, local configs, compiled ZSH files (*.zwc)
- `zshenv` - Sets `$CFG`, `$CLOUD`, `$ZSH_LIBS` variables
- User-specific: `~/.zshrc_local` (if present, sourced from zshenv)

## Env variables

- `$CFG` / `$CLOUD` - Configuration directory (defaults to `~/cfg`)
- `$ZSH_LIBS` - Path to library directory (`$HOME/bin/zsh_libs`)
- `$ZDOTDIR` - ZSH config directory (this repo's root)
- `$DEBUG` - Debug level (0-3, controls verbosity)
- `$VERSION` - Each library file declares its version

## Notes

- This is a personal utility collection optimized for the author's workflow
- Heavy use of ZSH-specific features (associative arrays, extended globbing, zparseopts)
- Many functions assume ZSH 5.0+ features
- SQL functions are configured for MySQL/MariaDB with credentials in `$CFG/sql.cfg.zsh`
- Git functions have hardcoded user email/name in `zsh_git:42-43`
- Plugin manager: zinit (installed to `$ZPM_HOME`)
